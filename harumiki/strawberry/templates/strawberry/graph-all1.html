<!-- strawberry/templates/strawberry/graph-all1.html -->
{% extends 'strawberry/base.html' %}
{% load static %}

{% block title %}All Sensors Graph - Harumiki Smart Farm{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/graph-all.css' %}">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
{% endblock %}

{% block content %}
<div class="graph-all-container">
    <!-- Header -->
    <!-- <div class="graph-header">
        <h1><i class="bi bi-graph-up"></i> Harumiki Smart Farm - All Sensors Overview</h1>
        <p class="subtitle">Farm 1 - Normalized Data Visualization (0-100 Scale)</p>
    </div> -->

    <!-- Date Filter Form -->
    <div class="filter-section">
        <form method="GET" action="{% url 'graph-all1' %}" class="date-filter-form">
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label for="start-date" class="form-label">
                        <i class="bi bi-calendar-date"></i> Start Date
                    </label>
                    <input type="date" id="start-date" name="start_date" 
                           class="form-control" value="{{ request.GET.start_date }}">
                </div>
                <div class="col-md-4">
                    <label for="end-date" class="form-label">
                        <i class="bi bi-calendar-date"></i> End Date
                    </label>
                    <input type="date" id="end-date" name="end_date" 
                           class="form-control" value="{{ request.GET.end_date }}">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-funnel"></i> Apply Filter
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Legend Toggle Controls -->
    <div class="legend-controls">
        <h3>Toggle Sensor Groups</h3>
        <div class="button-group">
            <button class="btn btn-sm btn-outline-primary toggle-group" data-group="air">
                <i class="bi bi-wind"></i> Air Quality
            </button>
            <button class="btn btn-sm btn-outline-primary toggle-group" data-group="light">
                <i class="bi bi-brightness-high"></i> Light
            </button>
            <button class="btn btn-sm btn-outline-primary toggle-group" data-group="npk">
                <i class="bi bi-tree"></i> NPK
            </button>
            <button class="btn btn-sm btn-outline-primary toggle-group" data-group="temp">
                <i class="bi bi-thermometer-half"></i> Temperature
            </button>
            <button class="btn btn-sm btn-outline-primary toggle-group" data-group="humidity">
                <i class="bi bi-droplet"></i> Humidity/Moisture
            </button>
            <button class="btn btn-sm btn-outline-primary toggle-group" data-group="water">
                <i class="bi bi-water"></i> Water
            </button>
        </div>
        <div class="button-group mt-2">
            <button class="btn btn-sm btn-success" id="show-all">Show All</button>
            <button class="btn btn-sm btn-danger" id="hide-all">Hide All</button>
        </div>
    </div>

    <!-- Main Chart -->
    <div class="chart-section">
        <div class="chart-card">
            <div class="chart-header">
                <h2>All Farm 1 Sensors - Normalized View</h2>
                <span class="chart-unit">Normalized Scale (0-100)</span>
            </div>
            <div class="chart-body">
                <canvas id="allSensorsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Data Info Table -->
    <div class="data-info-section">
        <h3>Normalization Reference</h3>
        <div class="info-table">
            <table class="table table-sm table-striped">
                <thead>
                    <tr>
                        <th>Sensor</th>
                        <th>Max Value</th>
                        <th>Unit</th>
                        <th>Group</th>
                    </tr>
                </thead>
                <tbody id="normalization-info">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Hidden data container -->
    <div id="chart-data" class="d-none"
         data-pm-r1="{{ pm_R1.values }}"
         data-pm-r1-times="{{ pm_R1.datetimes|safe }}"
         data-pm-outside="{{ pm_outside.values }}"
         data-pm-outside-times="{{ pm_outside.datetimes|safe }}"
         data-uv-r8="{{ UV_R8.values }}"
         data-uv-r8-times="{{ UV_R8.datetimes|safe }}"
         data-lux-r8="{{ LUX_R8.values }}"
         data-lux-r8-times="{{ LUX_R8.datetimes|safe }}"
         data-co2-r1="{{ CO2_R1.values }}"
         data-co2-r1-times="{{ CO2_R1.datetimes|safe }}"
         data-co2-r2="{{ CO2_R2.values }}"
         data-co2-r2-times="{{ CO2_R2.datetimes|safe }}"
         data-ppfd3="{{ ppfd3.values }}"
         data-ppfd3-times="{{ ppfd3.datetimes|safe }}"
         data-ppfd4="{{ ppfd4.values }}"
         data-ppfd4-times="{{ ppfd4.datetimes|safe }}"
         data-nitrogen4="{{ nitrogen4.values }}"
         data-nitrogen4-times="{{ nitrogen4.datetimes|safe }}"
         data-nitrogen5="{{ nitrogen5.values }}"
         data-nitrogen5-times="{{ nitrogen5.datetimes|safe }}"
         data-nitrogen6="{{ nitrogen6.values }}"
         data-nitrogen6-times="{{ nitrogen6.datetimes|safe }}"
         data-phosphorus4="{{ phosphorus4.values }}"
         data-phosphorus4-times="{{ phosphorus4.datetimes|safe }}"
         data-phosphorus5="{{ phosphorus5.values }}"
         data-phosphorus5-times="{{ phosphorus5.datetimes|safe }}"
         data-phosphorus6="{{ phosphorus6.values }}"
         data-phosphorus6-times="{{ phosphorus6.datetimes|safe }}"
         data-potassium4="{{ potassium4.values }}"
         data-potassium4-times="{{ potassium4.datetimes|safe }}"
         data-potassium5="{{ potassium5.values }}"
         data-potassium5-times="{{ potassium5.datetimes|safe }}"
         data-potassium6="{{ potassium6.values }}"
         data-potassium6-times="{{ potassium6.datetimes|safe }}"
         data-air-temp3="{{ airTemp3.values }}"
         data-air-temp3-times="{{ airTemp3.datetimes|safe }}"
         data-air-temp4="{{ airTemp4.values }}"
         data-air-temp4-times="{{ airTemp4.datetimes|safe }}"
         data-air-temp5="{{ airTemp5.values }}"
         data-air-temp5-times="{{ airTemp5.datetimes|safe }}"
         data-temp-npk4="{{ temp_npk4.values }}"
         data-temp-npk4-times="{{ temp_npk4.datetimes|safe }}"
         data-temp-npk5="{{ temp_npk5.values }}"
         data-temp-npk5-times="{{ temp_npk5.datetimes|safe }}"
         data-temp-npk6="{{ temp_npk6.values }}"
         data-temp-npk6-times="{{ temp_npk6.datetimes|safe }}"
         data-temp-wm="{{ TempWM.values }}"
         data-temp-wm-times="{{ TempWM.datetimes|safe }}"
         data-air-hum3="{{ airHum3.values }}"
         data-air-hum3-times="{{ airHum3.datetimes|safe }}"
         data-air-hum4="{{ airHum4.values }}"
         data-air-hum4-times="{{ airHum4.datetimes|safe }}"
         data-air-hum5="{{ airHum5.values }}"
         data-air-hum5-times="{{ airHum5.datetimes|safe }}"
         data-soil7="{{ soil7.values }}"
         data-soil7-times="{{ soil7.datetimes|safe }}"
         data-soil8="{{ soil8.values }}"
         data-soil8-times="{{ soil8.datetimes|safe }}"
         data-soil9="{{ soil9.values }}"
         data-soil9-times="{{ soil9.datetimes|safe }}"
         data-soil10="{{ soil10.values }}"
         data-soil10-times="{{ soil10.datetimes|safe }}"
         data-soil11="{{ soil11.values }}"
         data-soil11-times="{{ soil11.datetimes|safe }}"
         data-soil12="{{ soil12.values }}"
         data-soil12-times="{{ soil12.datetimes|safe }}"
         data-ecwm="{{ ECWM.values }}"
         data-ecwm-times="{{ ECWM.datetimes|safe }}"
         data-ecwp="{{ ECWP.values }}"
         data-ecwp-times="{{ ECWP.datetimes|safe }}"
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/utils.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="{% static 'js/graph-all.js' %}"></script>
{% endblock %}