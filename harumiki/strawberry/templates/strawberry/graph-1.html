<!-- strawberry/templates/strawberry/graph-1.html -->
{% extends 'strawberry/base.html' %}
{% load static %}
{% load json_filters %}

{% block title %}Data Visualization Farm 1 - Harumiki Smart Farm{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/graph.css' %}">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
{% endblock %}

{% block content %}
<div class="graph-dashboard-container">
    <!-- Header -->
    <!-- <div class="dashboard-header">
        <h1><i class="bi bi-graph-up"></i> Harumiki Smart Farm - Data Visualization</h1>
        <p class="subtitle">Farm 1 Environmental & Agricultural Monitoring</p>
    </div> -->

    <!-- Date Filter Form -->
    <div class="filter-section">
        <form method="GET" action="{% url 'graph-1' %}" class="date-filter-form">
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label for="start-date" class="form-label">
                        <i class="bi bi-calendar-date"></i> Start Date
                    </label>
                    <input type="date" id="start-date" name="start_date" 
                           class="form-control" value="{{ request.GET.start_date }}">
                </div>
                <div class="col-md-4">
                    <label for="end-date" class="form-label">
                        <i class="bi bi-calendar-date"></i> End Date
                    </label>
                    <input type="date" id="end-date" name="end_date" 
                           class="form-control" value="{{ request.GET.end_date }}">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-funnel"></i> Apply Filter
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Air Quality Charts -->
    <div class="chart-section">
        <div class="section-header">
            <h2><i class="bi bi-wind"></i> Air Quality Monitoring</h2>
        </div>
        
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>PM 2.5 Levels</h3>
                        <span class="chart-unit">μg/m³</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="pmChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Carbon Dioxide</h3>
                        <span class="chart-unit">ppm</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="CO2_Chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Light Monitoring Charts -->
    <div class="chart-section">
        <div class="section-header">
            <h2><i class="bi bi-brightness-high"></i> Light Monitoring</h2>
        </div>
        
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>LUX & UV Radiation</h3>
                        <span class="chart-unit">lux / nm</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="SunChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>PPFD Levels</h3>
                        <span class="chart-unit">μmol/s.m²</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="ppfd_Chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Soil Analysis Charts -->
    <div class="chart-section">
        <div class="section-header">
            <h2><i class="bi bi-tree"></i> Soil Analysis</h2>
        </div>
        
        <div class="row">
            <div class="col-lg-12 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>NPK Nutrient Levels</h3>
                        <span class="chart-unit">mg/kg</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="NPK_Chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Environmental Conditions Charts -->
    <div class="chart-section">
        <div class="section-header">
            <h2><i class="bi bi-thermometer-half"></i> Environmental Conditions</h2>
        </div>
        
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Temperature Monitoring</h3>
                        <span class="chart-unit">°C</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="Temp_env_Chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Humidity & Moisture</h3>
                        <span class="chart-unit">%</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="hum_mois_env_Chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Water Quality Charts -->
    <div class="chart-section">
        <div class="section-header">
            <h2><i class="bi bi-water"></i> Water Quality</h2>
        </div>
        
        <div class="row">
            <div class="col-lg-12 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Electrical Conductivity</h3>
                        <span class="chart-unit">μS/cm</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="EC_Chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden data containers for Farm 1 -->
    <div id="chart-data" class="d-none"
         data-pm-outside="{{ pm_outside.values }}"
         data-pm-outside-times="{{ pm_outside.datetimes|safe }}"
         data-pm-r1="{{ pm_R1.values }}"
         data-uv-r8="{{ UV_R8.values }}"
         data-uv-r8-times="{{ UV_R8.datetimes|safe }}"
         data-lux-r8="{{ LUX_R8.values }}"
         data-co2-r1="{{ CO2_R1.values }}"
         data-co2-r1-times="{{ CO2_R1.datetimes|safe }}"
         data-co2-r2="{{ CO2_R2.values }}"
         data-ppfd3="{{ ppfd3.values }}"
         data-ppfd3-times="{{ ppfd3.datetimes|safe }}"
         data-ppfd4="{{ ppfd4.values }}"
         data-nitrogen-r8="{{ nitrogen4.values }}"
         data-nitrogen-r8-times="{{ nitrogen4.datetimes|safe }}"
         data-nitrogen-r16="{{ nitrogen5.values }}"
         data-nitrogen-r24="{{ nitrogen6.values }}"
         data-phosphorus-r8="{{ phosphorus4.values }}"
         data-phosphorus-r16="{{ phosphorus5.values }}"
         data-phosphorus-r24="{{ phosphorus6.values }}"
         data-potassium-r8="{{ potassium4.values }}"
         data-potassium-r16="{{ potassium5.values }}"
         data-potassium-r24="{{ potassium6.values }}"
         data-temp-npk-r8="{{ temp_npk4.values }}"
         data-temp-npk-r8-times="{{ temp_npk4.datetimes|safe }}"
         data-temp-npk-r16="{{ temp_npk5.values }}"
         data-temp-npk-r24="{{ temp_npk6.values }}"
         data-air-temp-r8="{{ airTemp3.values }}"
         data-air-temp-r16="{{ airTemp4.values }}"
         data-air-temp-r24="{{ airTemp5.values }}"
         data-temp-wm="{{ TempWM.values }}"
         data-air-hum-r8="{{ airHum3.values }}"
         data-air-hum-r8-times="{{ airHum3.datetimes|safe }}"
         data-air-hum-r16="{{ airHum4.values }}"
         data-air-hum-r24="{{ airHum5.values }}"
         data-soil7="{{ soil7.values }}"
         data-soil8="{{ soil8.values }}"
         data-soil9="{{ soil9.values }}"
         data-soil10="{{ soil10.values }}"
         data-soil11="{{ soil11.values }}"
         data-soil12="{{ soil12.values }}"
         data-ecwm="{{ ECWM.values }}"
         data-ecwm-times="{{ ECWM.datetimes|safe }}">
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/utils.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
<script src="{% static 'js/graph-combined.js' %}"></script>
{% endblock %}